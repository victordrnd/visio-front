(self.webpackChunkvisio=self.webpackChunkvisio||[]).push([[28],{3028:(e,t,n)=>{"use strict";n.r(t),n.d(t,{DashboardModule:()=>Pt});var i=n(8583),o=n(4655),r=n(7716),s=n(6304),a=n(6215),c=n(1983),l=n(8542);let d=(()=>{class e{constructor(e,t,n,i){this.socketService=e,this.modalService=t,this.router=n,this.location=i,this.peerConnectionSubject=new a.X(this.openRTCConnection()),this.audioService=new Audio}registerOnPhoneCallEvent(){var e=this;this.socketService.fromEvent("phone.call").subscribe(e=>{this.audioService.src="../../../../assets/mp3/marimba.mp3",this.audioService.load(),this.audioService.play(),this.openPhoneRiggingModal(e)}),this.peerConnection.onicecandidate=e=>{e.candidate&&this.socketService.emit("phone.new-ice-candidate",e.candidate)},this.peerConnection.onnegotiationneeded=e=>{this.peerConnection.createOffer().then(e=>this.peerConnection.setLocalDescription(e)).then(()=>this.socketService.emit("phone.negociating",this.peerConnection.localDescription)).catch(e=>console.log(e))},this.socketService.fromEvent("phone.negociating").subscribe(e=>{console.log("Phone.negociating",e),this.sendAnswer({video:!0,session:e})}),this.socketService.fromEvent("phone.answer").subscribe(e=>{this.peerConnection.setRemoteDescription(new RTCSessionDescription(e))}),this.socketService.fromEvent("phone.new-ice-candidate").subscribe(function(){var t=(0,s.Z)(function*(t){const n=new RTCIceCandidate(t);try{yield e.peerConnection.addIceCandidate(n)}catch(i){}});return function(e){return t.apply(this,arguments)}}())}openPhoneRiggingModal(e){var t=this;const n=this.modalService.info({nzTitle:"Phone call received",nzOkText:"Answer",nzCancelText:"Raccrocher",nzOnOk:(i=(0,s.Z)(function*(){t.audioService.pause(),t.router.navigate(["/dashboard/video-call"],{state:{video:e.video}}),yield t.sendAnswer(e)}),function(){return i.apply(this,arguments)}),nzOnCancel:()=>{this.audioService.pause(),n.close()}});var i}startCall(e=!1,t=[]){var n=this;return(0,s.Z)(function*(){n.peerConnection.onicecandidate=e=>{e.candidate&&n.socketService.emit("phone.new-ice-candidate",e.candidate)},n.myStream=yield n.getMediaStream(e),n.addTracksToPeerConnection(n.myStream);let t=yield n.peerConnection.createOffer();n.peerConnection.setLocalDescription(t),console.log("Phone calling"),n.socketService.emit("phone.calling",e,t)})()}sendAnswer(e){var t=this;return(0,s.Z)(function*(){yield t.peerConnection.setRemoteDescription(new RTCSessionDescription(e.session));const n=yield t.peerConnection.createAnswer();t.myStream||(t.myStream=yield t.getMediaStream(e.video),t.addTracksToPeerConnection(t.myStream)),t.peerConnection.setLocalDescription(n),t.socketService.emit("phone.answer",n)})()}startScreenShare(){var e=this;return(0,s.Z)(function*(){const t=yield e.getDisplayMediaStream(),n=t.getVideoTracks()[0];if(e.videoTrack){e.videoTrack.replaceTrack(n);try{e.videoTrack=e.peerConnection.addTrack(n,e.myStream)}catch(i){e.myStream.getVideoTracks().forEach(e=>e.enabled=!0)}}else console.log("no video track detected, set new "),e.addTracksToPeerConnection(t)})()}stopScreenShare(){var e=this;return(0,s.Z)(function*(){e.myStream&&e.myStream.getVideoTracks().forEach(e=>{e.enabled=!1})})()}hangUp(){this.peerConnection.close(),this.myStream&&this.myStream.getTracks().forEach(e=>e.stop()),this.peerConnectionSubject.next(this.openRTCConnection()),this.location.back()}getMediaStream(e=!1){return(0,s.Z)(function*(){let t;try{t=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!!e&&{width:{ideal:4096},height:{ideal:2160}}})}catch(n){t=yield navigator.mediaDevices.getUserMedia({audio:!1,video:!0})}return t})()}getDisplayMediaStream(){return(0,s.Z)(function*(){return yield navigator.mediaDevices.getDisplayMedia({audio:!0,video:!0})})()}addTracksToPeerConnection(e){e.getTracks().forEach(t=>{this.videoTrack=this.peerConnection.addTrack(t,e)})}toggleMicrophone(){this.myStream&&this.myStream.getAudioTracks().forEach(e=>e.enabled=!e.enabled)}toggleCamera(){this.myStream&&this.myStream.getVideoTracks().forEach(e=>e.enabled=!e.enabled)}registerEvents(){}openRTCConnection(){return new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]})}get peerConnection(){return this.peerConnectionSubject.getValue()}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(c.sk),r.LFG(l.Sf),r.LFG(o.F0),r.LFG(i.Ye))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var h=n(946),g=n(9765),p=n(6782),u=n(4762),m=n(521),z=n(4226),f=n(6182),v=n(3730),y=n(5072),C=n(3599);const T=["*"];function w(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",2),r.NdJ("click",function(){r.CHM(e);const t=r.oxw();return t.setCollapsed(!t.nzCollapsed)}),r.qZA()}if(2&e){const e=r.oxw();r.Q6J("matchBreakPoint",e.matchBreakPoint)("nzCollapsedWidth",e.nzCollapsedWidth)("nzCollapsed",e.nzCollapsed)("nzBreakpoint",e.nzBreakpoint)("nzReverseArrow",e.nzReverseArrow)("nzTrigger",e.nzTrigger)("nzZeroTrigger",e.nzZeroTrigger)("siderWidth",e.widthSetting)}}const S=["nz-sider-trigger",""];function b(e,t){}function x(e,t){if(1&e&&(r.ynx(0),r.YNc(1,b,0,0,"ng-template",3),r.BQk()),2&e){const e=r.oxw(),t=r.MAs(5);r.xp6(1),r.Q6J("ngTemplateOutlet",e.nzZeroTrigger||t)}}function M(e,t){}function k(e,t){if(1&e&&(r.ynx(0),r.YNc(1,M,0,0,"ng-template",3),r.BQk()),2&e){const e=r.oxw(),t=r.MAs(3);r.xp6(1),r.Q6J("ngTemplateOutlet",e.nzTrigger||t)}}function O(e,t){if(1&e&&r._UZ(0,"i",5),2&e){const e=r.oxw(2);r.Q6J("nzType",e.nzCollapsed?"right":"left")}}function Z(e,t){if(1&e&&r._UZ(0,"i",5),2&e){const e=r.oxw(2);r.Q6J("nzType",e.nzCollapsed?"left":"right")}}function _(e,t){if(1&e&&(r.YNc(0,O,1,1,"i",4),r.YNc(1,Z,1,1,"i",4)),2&e){const e=r.oxw();r.Q6J("ngIf",!e.nzReverseArrow),r.xp6(1),r.Q6J("ngIf",e.nzReverseArrow)}}function A(e,t){1&e&&r._UZ(0,"i",6)}let R=(()=>{class e{constructor(e,t){this.elementRef=e,this.renderer=t,this.renderer.addClass(this.elementRef.nativeElement,"ant-layout-content")}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.SBq),r.Y36(r.Qsj))},e.\u0275cmp=r.Xpm({type:e,selectors:[["nz-content"]],exportAs:["nzContent"],ngContentSelectors:T,decls:1,vars:0,template:function(e,t){1&e&&(r.F$t(),r.Hsn(0))},encapsulation:2,changeDetection:0}),e})(),P=(()=>{class e{constructor(e,t,n,i){this.platform=e,this.cdr=t,this.breakpointService=n,this.elementRef=i,this.destroy$=new g.xQ,this.nzMenuDirective=null,this.nzCollapsedChange=new r.vpe,this.nzWidth=200,this.nzTheme="dark",this.nzCollapsedWidth=80,this.nzBreakpoint=null,this.nzZeroTrigger=null,this.nzTrigger=void 0,this.nzReverseArrow=!1,this.nzCollapsible=!1,this.nzCollapsed=!1,this.matchBreakPoint=!1,this.flexSetting=null,this.widthSetting=null,this.elementRef.nativeElement.classList.add("ant-layout-sider")}updateStyleMap(){this.widthSetting=this.nzCollapsed?`${this.nzCollapsedWidth}px`:(0,f.WX)(this.nzWidth),this.flexSetting=`0 0 ${this.widthSetting}`,this.cdr.markForCheck()}updateMenuInlineCollapsed(){this.nzMenuDirective&&"inline"===this.nzMenuDirective.nzMode&&0!==this.nzCollapsedWidth&&this.nzMenuDirective.setInlineCollapsed(this.nzCollapsed)}setCollapsed(e){e!==this.nzCollapsed&&(this.nzCollapsed=e,this.nzCollapsedChange.emit(e),this.updateMenuInlineCollapsed(),this.updateStyleMap(),this.cdr.markForCheck())}ngOnInit(){this.updateStyleMap(),this.platform.isBrowser&&this.breakpointService.subscribe(z.ow,!0).pipe((0,p.R)(this.destroy$)).subscribe(e=>{const t=this.nzBreakpoint;t&&(0,f.ov)().subscribe(()=>{this.matchBreakPoint=!e[t],this.setCollapsed(this.matchBreakPoint),this.cdr.markForCheck()})})}ngOnChanges(e){const{nzCollapsed:t,nzCollapsedWidth:n,nzWidth:i}=e;(t||n||i)&&this.updateStyleMap(),t&&this.updateMenuInlineCollapsed()}ngAfterContentInit(){this.updateMenuInlineCollapsed()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(m.t4),r.Y36(r.sBO),r.Y36(z.r3),r.Y36(r.SBq))},e.\u0275cmp=r.Xpm({type:e,selectors:[["nz-sider"]],contentQueries:function(e,t,n){if(1&e&&r.Suo(n,v.wO,5),2&e){let e;r.iGM(e=r.CRH())&&(t.nzMenuDirective=e.first)}},hostVars:16,hostBindings:function(e,t){2&e&&(r.Udp("flex",t.flexSetting)("max-width",t.widthSetting)("min-width",t.widthSetting)("width",t.widthSetting),r.ekj("ant-layout-sider-zero-width",t.nzCollapsed&&0===t.nzCollapsedWidth)("ant-layout-sider-light","light"===t.nzTheme)("ant-layout-sider-dark","dark"===t.nzTheme)("ant-layout-sider-collapsed",t.nzCollapsed))},inputs:{nzWidth:"nzWidth",nzTheme:"nzTheme",nzCollapsedWidth:"nzCollapsedWidth",nzBreakpoint:"nzBreakpoint",nzZeroTrigger:"nzZeroTrigger",nzTrigger:"nzTrigger",nzReverseArrow:"nzReverseArrow",nzCollapsible:"nzCollapsible",nzCollapsed:"nzCollapsed"},outputs:{nzCollapsedChange:"nzCollapsedChange"},exportAs:["nzSider"],features:[r.TTD],ngContentSelectors:T,decls:3,vars:1,consts:[[1,"ant-layout-sider-children"],["nz-sider-trigger","",3,"matchBreakPoint","nzCollapsedWidth","nzCollapsed","nzBreakpoint","nzReverseArrow","nzTrigger","nzZeroTrigger","siderWidth","click",4,"ngIf"],["nz-sider-trigger","",3,"matchBreakPoint","nzCollapsedWidth","nzCollapsed","nzBreakpoint","nzReverseArrow","nzTrigger","nzZeroTrigger","siderWidth","click"]],template:function(e,t){1&e&&(r.F$t(),r.TgZ(0,"div",0),r.Hsn(1),r.qZA(),r.YNc(2,w,1,8,"div",1)),2&e&&(r.xp6(2),r.Q6J("ngIf",t.nzCollapsible&&null!==t.nzTrigger))},directives:function(){return[i.O5,N]},encapsulation:2,changeDetection:0}),(0,u.gn)([(0,f.yF)()],e.prototype,"nzReverseArrow",void 0),(0,u.gn)([(0,f.yF)()],e.prototype,"nzCollapsible",void 0),(0,u.gn)([(0,f.yF)()],e.prototype,"nzCollapsed",void 0),e})(),Y=(()=>{class e{constructor(e,t){this.elementRef=e,this.directionality=t,this.dir="ltr",this.destroy$=new g.xQ,this.elementRef.nativeElement.classList.add("ant-layout")}ngOnInit(){var e;this.dir=this.directionality.value,null===(e=this.directionality.change)||void 0===e||e.pipe((0,p.R)(this.destroy$)).subscribe(e=>{this.dir=e})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.SBq),r.Y36(h.Is,8))},e.\u0275cmp=r.Xpm({type:e,selectors:[["nz-layout"]],contentQueries:function(e,t,n){if(1&e&&r.Suo(n,P,4),2&e){let e;r.iGM(e=r.CRH())&&(t.listOfNzSiderComponent=e)}},hostVars:4,hostBindings:function(e,t){2&e&&r.ekj("ant-layout-rtl","rtl"===t.dir)("ant-layout-has-sider",t.listOfNzSiderComponent.length>0)},exportAs:["nzLayout"],ngContentSelectors:T,decls:1,vars:0,template:function(e,t){1&e&&(r.F$t(),r.Hsn(0))},encapsulation:2,changeDetection:0}),e})(),N=(()=>{class e{constructor(){this.nzCollapsed=!1,this.nzReverseArrow=!1,this.nzZeroTrigger=null,this.nzTrigger=void 0,this.matchBreakPoint=!1,this.nzCollapsedWidth=null,this.siderWidth=null,this.nzBreakpoint=null,this.isZeroTrigger=!1,this.isNormalTrigger=!1}updateTriggerType(){this.isZeroTrigger=0===this.nzCollapsedWidth&&(this.nzBreakpoint&&this.matchBreakPoint||!this.nzBreakpoint),this.isNormalTrigger=0!==this.nzCollapsedWidth}ngOnInit(){this.updateTriggerType()}ngOnChanges(){this.updateTriggerType()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Xpm({type:e,selectors:[["","nz-sider-trigger",""]],hostVars:10,hostBindings:function(e,t){2&e&&(r.Udp("width",t.isNormalTrigger?t.siderWidth:null),r.ekj("ant-layout-sider-trigger",t.isNormalTrigger)("ant-layout-sider-zero-width-trigger",t.isZeroTrigger)("ant-layout-sider-zero-width-trigger-right",t.isZeroTrigger&&t.nzReverseArrow)("ant-layout-sider-zero-width-trigger-left",t.isZeroTrigger&&!t.nzReverseArrow))},inputs:{nzCollapsed:"nzCollapsed",nzReverseArrow:"nzReverseArrow",nzZeroTrigger:"nzZeroTrigger",nzTrigger:"nzTrigger",matchBreakPoint:"matchBreakPoint",nzCollapsedWidth:"nzCollapsedWidth",siderWidth:"siderWidth",nzBreakpoint:"nzBreakpoint"},exportAs:["nzSiderTrigger"],features:[r.TTD],attrs:S,decls:6,vars:2,consts:[[4,"ngIf"],["defaultTrigger",""],["defaultZeroTrigger",""],[3,"ngTemplateOutlet"],["nz-icon","",3,"nzType",4,"ngIf"],["nz-icon","",3,"nzType"],["nz-icon","","nzType","bars"]],template:function(e,t){1&e&&(r.YNc(0,x,2,1,"ng-container",0),r.YNc(1,k,2,1,"ng-container",0),r.YNc(2,_,2,2,"ng-template",null,1,r.W1O),r.YNc(4,A,1,0,"ng-template",null,2,r.W1O)),2&e&&(r.Q6J("ngIf",t.isZeroTrigger),r.xp6(1),r.Q6J("ngIf",t.isNormalTrigger))},directives:[i.O5,i.tP,C.Ls],encapsulation:2,changeDetection:0}),e})(),B=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[h.vT,i.ez,C.PV,y.xu,m.ud]]}),e})();var D=n(7519),J=n(263),q=n(3404),Q=n(5181),F=n(3521),I=n(4514);let L=(()=>{class e{constructor(e){this.authService=e}transform(e,...t){var n;const i=null===(n=null==e?void 0:e.users)||void 0===n?void 0:n.filter(e=>e.id!=this.authService.current_user.id);return null==i?void 0:i.map(e=>e.firstname+" "+e.lastname).join(", ")}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(J.e,16))},e.\u0275pipe=r.Yjl({name:"roomTitle",type:e,pure:!0}),e})(),E=(()=>{class e{constructor(e,t,n,i,o,r){this.authService=e,this.socketService=t,this.roomService=n,this.router=i,this.callService=o,this.notificationService=r,this.subscriptions=[],this.users_ids=[]}ngOnInit(){const e=this.roomService.currentRoom.pipe((0,D.x)()).subscribe(e=>{this.room=e,this.users_ids=this.room.users.map(e=>e.user_id)});this.subscriptions.push(e)}reconnect(){this.socketService.init({user:this.authService.current_user})}disconnect(){this.authService.purgeAuth(),this.router.navigate([""]),this.notificationService.success("Succ\xe8s","Vous avez \xe9t\xe9 d\xe9connect\xe9 avec succ\xe8s")}startCall(e=!1){var t=this;return(0,s.Z)(function*(){yield t.callService.startCall(e,t.users_ids),t.router.navigate(["/dashboard/video-call"],{state:{video:e}})})()}ngOnDestroy(){this.subscriptions.map(e=>e.unsubscribe())}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(J.e),r.Y36(q.$),r.Y36(Q.L),r.Y36(o.F0),r.Y36(d),r.Y36(F.zb))},e.\u0275cmp=r.Xpm({type:e,selectors:[["app-header"]],decls:17,vars:5,consts:[["nz-menu","","nzMode","horizontal"],["nz-menu-item","",1,"px-0",2,"width","19vw"],[1,"logo","mx-auto","d-block"],["src","../../../assets/img/logo.png",2,"width","40px"],["nz-menu-item","","nzSelected",""],["nz-menu-item",""],[3,"click"],["nz-menu-item","",1,"float-end",3,"click"],["nz-icon","","nzType","logout","nzTheme","outline"],["nz-icon","","nzType","phone","nzTheme","outline"],["nz-icon","","nzType","video-camera","nzTheme","outline"]],template:function(e,t){1&e&&(r.TgZ(0,"ul",0),r.TgZ(1,"li",1),r.TgZ(2,"div",2),r._UZ(3,"img",3),r.qZA(),r.qZA(),r.TgZ(4,"li",4),r._uU(5),r.ALo(6,"titlecase"),r.ALo(7,"roomTitle"),r.qZA(),r.TgZ(8,"li",5),r.TgZ(9,"a",6),r.NdJ("click",function(){return t.reconnect()}),r._uU(10,"Me reconnecter"),r.qZA(),r.qZA(),r.TgZ(11,"li",7),r.NdJ("click",function(){return t.disconnect()}),r._UZ(12,"i",8),r.qZA(),r.TgZ(13,"li",7),r.NdJ("click",function(){return t.startCall()}),r._UZ(14,"i",9),r.qZA(),r.TgZ(15,"li",7),r.NdJ("click",function(){return t.startCall(!0)}),r._UZ(16,"i",10),r.qZA(),r.qZA()),2&e&&(r.xp6(5),r.hij(" ",r.lcZ(6,1,r.lcZ(7,3,t.room))," "))},directives:[v.wO,v.r9,I.w,C.Ls],pipes:[i.rS,L],styles:[".logo[_ngcontent-%COMP%]{width:50px;margin:0}[_nghost-%COMP%]  .ant-menu-horizontal>.ant-menu-item:after, [_nghost-%COMP%]  .ant-menu-horizontal>.ant-menu-submenu:after{left:0;right:0}[_nghost-%COMP%]  .ant-menu-horizontal{line-height:55px}"]}),e})();var $=n(2340),U=n(1841);let H=(()=>{class e{constructor(e,t){this.http=e,this.socket=t,this.connectedUsersList=[]}list(){return this.http.get($.N.apiUrl+"/users")}registerUsersConnection(){this.socket.onNewConnection().subscribe(e=>{this.connectedUsersList=e})}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(U.eN),r.LFG(q.$))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var V=n(6349),W=n(665);function j(e,t){if(1&e&&r._UZ(0,"nz-option",3),2&e){const e=t.$implicit;r.Q6J("nzLabel",e.firstname+" "+e.lastname)("nzValue",e.id)}}function X(e,t){1&e&&r._uU(0),2&e&&r.hij("et ",t.$implicit.length," autres selectionn\xe9s")}let G=(()=>{class e{constructor(e){this.userService=e,this.users=[],this.user_ids=[]}ngOnInit(){this.fetchUsers()}fetchUsers(){var e=this;return(0,s.Z)(function*(){e.users=yield e.userService.list().toPromise()})()}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(H))},e.\u0275cmp=r.Xpm({type:e,selectors:[["app-create-room-modal"]],decls:6,vars:4,consts:[["nzMode","multiple","nzPlaceHolder","Selectionnez les membres de la conversation",1,"w-100","mb-5",3,"nzMaxTagCount","nzMaxTagPlaceholder","ngModel","ngModelChange"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["tagPlaceHolder",""],[3,"nzLabel","nzValue"]],template:function(e,t){if(1&e&&(r.TgZ(0,"label"),r._uU(1,"Membres de la conversation : "),r.qZA(),r.TgZ(2,"nz-select",0),r.NdJ("ngModelChange",function(e){return t.user_ids=e}),r.YNc(3,j,1,2,"nz-option",1),r.qZA(),r.YNc(4,X,1,1,"ng-template",null,2,r.W1O)),2&e){const e=r.MAs(5);r.xp6(2),r.Q6J("nzMaxTagCount",3)("nzMaxTagPlaceholder",e)("ngModel",t.user_ids),r.xp6(1),r.Q6J("ngForOf",t.users)}},directives:[V.Vq,W.JJ,W.On,i.sg,V.Ip],styles:[""]}),e})();var K=n(7674),ee=n(6845),te=n(4453),ne=n(9374),ie=n(853),oe=n(5329),re=n(2482);function se(e,t){if(1&e&&(r.TgZ(0,"nz-auto-option",12),r._uU(1),r.ALo(2,"roomTitle"),r.qZA()),2&e){const e=t.$implicit;r.Q6J("routerLink","/dashboard/room/"+e.id)("nzValue",e.id)("nzLabel",e.label),r.xp6(1),r.hij(" ",r.lcZ(2,4,e)," ")}}function ae(e,t){1&e&&r._UZ(0,"i",13)}function ce(e,t){if(1&e&&(r.TgZ(0,"li",14),r.TgZ(1,"nz-comment",15),r.ALo(2,"titlecase"),r.ALo(3,"roomTitle"),r._UZ(4,"nz-avatar",16),r.TgZ(5,"nz-comment-content"),r.TgZ(6,"p",17),r._uU(7),r.ALo(8,"date"),r.qZA(),r.qZA(),r.qZA(),r.qZA()),2&e){const e=t.$implicit;r.Q6J("routerLink","/dashboard/room/"+e.id),r.xp6(1),r.s9C("nzAuthor",r.lcZ(2,5,r.lcZ(3,7,e))),r.xp6(3),r.Q6J("nzSize",45),r.xp6(3),r.AsE("",null==e.last_message?null:e.last_message.message," \xb7 ",r.xi3(8,9,null==e.last_message?null:e.last_message.created_at,"H:mm"),"")}}function le(e,t){1&e&&r._UZ(0,"nz-empty")}function de(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"ul",1),r.TgZ(1,"li",2),r.TgZ(2,"nz-input-group",3),r.TgZ(3,"input",4),r.NdJ("ngModelChange",function(t){return r.CHM(e),r.oxw().searchTerm=t})("ngModelChange",function(t){return r.CHM(e),r.oxw().onChange(t)}),r.qZA(),r.TgZ(4,"nz-autocomplete",null,5),r.YNc(6,se,3,6,"nz-auto-option",6),r.qZA(),r.qZA(),r.YNc(7,ae,1,0,"ng-template",null,7,r.W1O),r.qZA(),r.YNc(9,ce,9,12,"li",8),r.YNc(10,le,1,0,"nz-empty",9),r.TgZ(11,"button",10),r.NdJ("click",function(){return r.CHM(e),r.oxw().openCreateRoomModal()}),r._uU(12,"R\xe9diger un message "),r._UZ(13,"i",11),r.qZA(),r.qZA()}if(2&e){const e=r.MAs(5),t=r.MAs(8),n=r.oxw();r.xp6(2),r.Q6J("nzSuffix",t),r.xp6(1),r.Q6J("ngModel",n.searchTerm)("nzAutocomplete",e),r.xp6(3),r.Q6J("ngForOf",n.filteredRooms),r.xp6(3),r.Q6J("ngForOf",n.rooms),r.xp6(1),r.Q6J("ngIf",0==n.rooms.length)}}let he=(()=>{class e{constructor(e,t,n,i,o){this.roomService=e,this.authService=t,this.cdr=n,this.modalService=i,this.socketService=o,this.rooms=[],this.users=[],this.searchTerm=null,this.filteredRooms=[]}ngOnInit(){console.log("init sidebar"),this.fetchRooms(),this.socketService.onRoomCreated().subscribe(()=>{this.fetchRooms()}),this.socketService.onNewMessage().subscribe(e=>{this.fetchRooms()})}fetchRooms(){var e=this;return(0,s.Z)(function*(){e.rooms=yield e.roomService.list().toPromise(),e.authService.current_user.rooms=e.rooms,e.filteredRooms=Object.assign([],e.rooms),e.cdr.detectChanges()})()}openCreateRoomModal(){this.modalService.create({nzContent:G,nzTitle:"D\xe9marrer une conversation",nzOnOk:e=>{e.user_ids.length&&this.roomService.store(e.user_ids).toPromise().then(t=>{this.socketService.createRoom(e.user_ids),this.fetchRooms()})}})}onChange(e){this.filteredRooms=this.rooms.filter(t=>-1!==t.label.toLowerCase().indexOf(e.toLowerCase()))}registerOnMessageSubscriber(){}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(Q.L),r.Y36(J.e),r.Y36(r.sBO),r.Y36(l.Sf),r.Y36(q.$))},e.\u0275cmp=r.Xpm({type:e,selectors:[["app-sidebar"]],decls:1,vars:1,consts:[["nz-menu","","nzMode","inline",4,"ngIf"],["nz-menu","","nzMode","inline"],[1,"p-2"],[1,"rounded",3,"nzSuffix"],["type","text","nz-input","","placeholder","Rechercher dans visio",3,"ngModel","nzAutocomplete","ngModelChange"],["auto",""],[3,"routerLink","nzValue","nzLabel",4,"ngFor","ngForOf"],["suffixIconSearch",""],["nz-menu-item","","class","pl-1 py-4",3,"routerLink",4,"ngFor","ngForOf"],[4,"ngIf"],["nz-button","","nzType","primary",1,"send-message-btn",3,"click"],["nz-icon","","nzType","edit","nzTheme","outline"],[3,"routerLink","nzValue","nzLabel"],["nz-icon","","nzType","search"],["nz-menu-item","",1,"pl-1","py-4",3,"routerLink"],[3,"nzAuthor"],["nz-comment-avatar","","nzText","NG",2,"background-color","#1890ff",3,"nzSize"],[1,"text-muted","message_preview"]],template:function(e,t){1&e&&r.YNc(0,de,14,6,"ul",0),2&e&&r.Q6J("ngIf",t.rooms)},directives:[i.O5,v.wO,I.w,K.gB,K.ke,K.Zp,W.Fj,ee.Pf,W.JJ,W.On,ee.gi,i.sg,te.ix,ne.dQ,C.Ls,ee.NB,o.rH,v.r9,ie.WE,oe.Dz,ie.DA,ie.Y4,re.p9],pipes:[L,i.rS,i.uU],styles:["[nz-menu][_ngcontent-%COMP%]{height:100%;min-height:94vh;width:19vw}.ant-layout-sider[_ngcontent-%COMP%]{position:relative;min-width:0;background:#fff;width:240px!important;transition:all .2s}li[_ngcontent-%COMP%]{outline:0}.send-message-btn[_ngcontent-%COMP%]{position:fixed;bottom:0;width:18.9vw;border-radius:0;padding-bottom:36px;padding-top:18px}[_nghost-%COMP%]  cdk-virtual-scroll-viewport{height:89vh;min-height:89vh}[_nghost-%COMP%]  nz-avatar{margin-right:14px}[_nghost-%COMP%]  .rounded{border-radius:30px!important}[_nghost-%COMP%]  .ant-comment-avatar{display:block;margin-top:auto;margin-bottom:auto}[_nghost-%COMP%]  .ant-comment-content{font-size:11px}[_nghost-%COMP%]  .ant-comment-content-author-name{color:#fff;font-size:13px!important}[_nghost-%COMP%]  .ant-comment-content-detail>p{line-height:14px}[_nghost-%COMP%]  .message_preview{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;width:220px;display:inline-block}[_nghost-%COMP%]  .ant-menu-inline .ant-menu-item{line-height:24px!important}"]}),e})(),ge=(()=>{class e{constructor(e){this.callService=e}ngOnInit(){this.callService.registerOnPhoneCallEvent(),this.callService.registerEvents()}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(d))},e.\u0275cmp=r.Xpm({type:e,selectors:[["app-dashboard"]],decls:7,vars:0,consts:[[1,"bg-grey"]],template:function(e,t){1&e&&(r.TgZ(0,"nz-layout"),r._UZ(1,"app-header"),r.TgZ(2,"nz-layout"),r.TgZ(3,"nz-sider"),r._UZ(4,"app-sidebar"),r.qZA(),r.TgZ(5,"nz-content",0),r._UZ(6,"router-outlet"),r.qZA(),r.qZA(),r.qZA())},directives:[Y,E,P,he,R,o.lC],styles:[".bg-grey[_ngcontent-%COMP%]{background-color:#1e1e1e}[_nghost-%COMP%]  .ant-layout-sider{flex:0 0 19vw!important;max-width:19vw!important;min-width:19vw!important;width:19vw!important}"]}),e})(),pe=(()=>{class e{constructor(e){this.http=e}send(e){return this.http.post($.N.apiUrl+"/messages",e)}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(U.eN))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const ue=["messageList"];function me(e,t){1&e&&r._UZ(0,"nz-avatar",14)}function ze(e,t){if(1&e&&(r.TgZ(0,"div",10),r.YNc(1,me,1,0,"nz-avatar",11),r.TgZ(2,"div",12),r.TgZ(3,"p",13),r._uU(4),r.qZA(),r.qZA(),r.qZA()),2&e){const e=t.$implicit,n=r.oxw(2);r.ekj("reply",e.user_id==n.current_user.id)("not-reply",e.user_id!=n.current_user.id),r.xp6(1),r.Q6J("ngIf",e.user_id!=n.current_user.id),r.xp6(3),r.Oqu(e.message)}}function fe(e,t){if(1&e&&(r.TgZ(0,"div",8),r.YNc(1,ze,5,6,"div",9),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.Q6J("ngForOf",e.room.messages)}}function ve(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",15),r.NdJ("click",function(){return r.CHM(e),r.oxw().sendMessage()}),r._UZ(1,"i",16),r.qZA()}}const ye=function(){return{minRows:1,maxRows:2}};let Ce=(()=>{class e{constructor(e,t,n,i,o){this.activatedRoute=e,this.roomService=t,this.messageService=n,this.authService=i,this.socketService=o,this.room_id=0,this.current_message="",this.users_ids=[],this.subscriptions=[]}ngOnInit(){const e=this.activatedRoute.params.subscribe(e=>{this.room_id=e.id,this.fetchRoom(),this.registerOnMessageSubscriber()});this.current_user=this.authService.current_user,this.subscriptions.push(e)}ngOnDestroy(){this.subscriptions.map(e=>e.unsubscribe())}fetchRoom(){var e=this;return(0,s.Z)(function*(){e.room=yield e.roomService.show(e.room_id).toPromise(),e.roomService.currentRoom.next(e.room),e.users_ids=e.room.users.map(e=>e.user_id),e.scrollDown()})()}sendMessage(){var e=this;return(0,s.Z)(function*(){if(e.current_message.length){const t={room_id:e.room.id,type:"text",message:e.current_message};yield e.messageService.send(t).toPromise().then(t=>{console.log(t),e.socketService.sendMessage({message:e.current_message,type:"text",room_id:e.room.id,user_id:t.user_id})}),e.current_message=""}})()}registerOnMessageSubscriber(){this.socketService.onNewMessage().subscribe(e=>{var t,n;null===(n=null===(t=this.room)||void 0===t?void 0:t.messages)||void 0===n||n.unshift(e),this.scrollDown()})}scrollDown(){this.messageList.nativeElement.scrollTop=this.messageList.nativeElement.scrollHeight,setTimeout(()=>{const e=document.getElementsByClassName("message_container");e.length&&e[0].scrollIntoView()},10)}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(o.gz),r.Y36(Q.L),r.Y36(pe),r.Y36(J.e),r.Y36(q.$))},e.\u0275cmp=r.Xpm({type:e,selectors:[["app-room"]],viewQuery:function(e,t){if(1&e&&r.Gf(ue,5),2&e){let e;r.iGM(e=r.CRH())&&(t.messageList=e.first)}},decls:9,vars:5,consts:[["itemSize","20",1,"scrollable"],["messageList",""],["class","messages",4,"ngIf"],[1,"footer"],["nz-icon","","nzType","file-add","nzTheme","fill",1,"mx-2","text-primary","h6","mt-2","cursor-pointer"],["nzSearch","",3,"nzAddOnAfter"],["maxlength","250","nz-input","","placeholder","","nzAutosize","",3,"ngModel","nzAutosize","keydown.enter","ngModelChange"],["suffixIconButton",""],[1,"messages"],["class","message_container",3,"reply","not-reply",4,"ngFor","ngForOf"],[1,"message_container"],["class","avatar","nzIcon","user","nzSize","large","style","vertical-align: middle;",4,"ngIf"],[1,"message"],[1,"text"],["nzIcon","user","nzSize","large",1,"avatar",2,"vertical-align","middle"],["nz-button","","nzType","primary","nzSearch","",3,"click"],["nz-icon","","nzType","send"]],template:function(e,t){if(1&e&&(r.TgZ(0,"div",0,1),r.YNc(2,fe,2,1,"div",2),r.qZA(),r.TgZ(3,"div",3),r._UZ(4,"i",4),r.TgZ(5,"nz-input-group",5),r.TgZ(6,"textarea",6),r.NdJ("keydown.enter",function(e){return e.preventDefault(),t.sendMessage()})("ngModelChange",function(e){return t.current_message=e}),r.qZA(),r.qZA(),r.YNc(7,ve,2,0,"ng-template",null,7,r.W1O),r.qZA()),2&e){const e=r.MAs(8);r.xp6(2),r.Q6J("ngIf",t.room),r.xp6(3),r.Q6J("nzAddOnAfter",e),r.xp6(1),r.Q6J("ngModel",t.current_message)("nzAutosize",r.DdM(4,ye))}},directives:[i.O5,C.Ls,I.w,K.gB,K.Zp,K.rh,W.Fj,W.nD,W.JJ,W.On,i.sg,oe.Dz,te.ix,ne.dQ],styles:[".footer[_ngcontent-%COMP%]{position:fixed;bottom:0;width:81vw;padding:5px 3px;display:flex}.scrollable[_ngcontent-%COMP%]{overflow:auto;flex:1;max-height:88vh;height:88vh}.scrollable[_ngcontent-%COMP%]   .messages[_ngcontent-%COMP%]{padding:1rem 1.25rem;overflow-y:auto;overflow-x:hidden;display:flex;flex-shrink:0;flex-direction:column-reverse}.scrollable[_ngcontent-%COMP%]   .messages[_ngcontent-%COMP%]   .message_container[_ngcontent-%COMP%]{margin-bottom:1.5rem;display:flex}.scrollable[_ngcontent-%COMP%]   .messages[_ngcontent-%COMP%]   .message_container[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{display:block;border-radius:50%;flex-shrink:0;background:#c5cee0;background-position:50%;background-size:cover;background-repeat:no-repeat;width:2.5rem;height:2.5rem;text-align:center;line-height:2.5rem;font-size:.875rem;color:#fff}.scrollable[_ngcontent-%COMP%]   .messages[_ngcontent-%COMP%]   .message_container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{width:-webkit-max-content;width:max-content;border-radius:.5rem}.scrollable[_ngcontent-%COMP%]   .messages[_ngcontent-%COMP%]   .message_container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{border-radius:.5rem;word-break:break-word;white-space:pre-wrap;max-width:100%;margin-top:0;margin-bottom:0;padding:.4rem .8rem}.scrollable[_ngcontent-%COMP%]   .messages[_ngcontent-%COMP%]   .message_container.not-reply[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{margin-left:1rem;margin-right:.5rem;display:flex}.scrollable[_ngcontent-%COMP%]   .messages[_ngcontent-%COMP%]   .message_container.not-reply[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{border-top-left-radius:0!important;background:#6367fc;color:#fff;align-items:flex-start}.scrollable[_ngcontent-%COMP%]   .messages[_ngcontent-%COMP%]   .message_container.reply[_ngcontent-%COMP%], .scrollable[_ngcontent-%COMP%]   .messages[_ngcontent-%COMP%]   .message_container.reply[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{flex-direction:row-reverse}.scrollable[_ngcontent-%COMP%]   .messages[_ngcontent-%COMP%]   .message_container.reply[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{background:#f7f9fc;color:#222b45;margin-left:3rem;border-bottom-right-radius:0!important}"]}),e})();var Te=n(2729),we=n(8178);function Se(e,t){1&e&&r.Hsn(0)}const be=["*"];function xe(e,t){if(1&e&&(r.ynx(0),r._uU(1),r.BQk()),2&e){const e=r.oxw(3);r.xp6(1),r.Oqu(e.nzTitle)}}function Me(e,t){if(1&e&&(r.TgZ(0,"div",11),r.YNc(1,xe,2,1,"ng-container",12),r.qZA()),2&e){const e=r.oxw(2);r.xp6(1),r.Q6J("nzStringTemplateOutlet",e.nzTitle)}}function ke(e,t){if(1&e&&(r.ynx(0),r._uU(1),r.BQk()),2&e){const e=r.oxw(3);r.xp6(1),r.Oqu(e.nzExtra)}}function Oe(e,t){if(1&e&&(r.TgZ(0,"div",13),r.YNc(1,ke,2,1,"ng-container",12),r.qZA()),2&e){const e=r.oxw(2);r.xp6(1),r.Q6J("nzStringTemplateOutlet",e.nzExtra)}}function Ze(e,t){}function _e(e,t){if(1&e&&(r.ynx(0),r.YNc(1,Ze,0,0,"ng-template",14),r.BQk()),2&e){const e=r.oxw(2);r.xp6(1),r.Q6J("ngTemplateOutlet",e.listOfNzCardTabComponent.template)}}function Ae(e,t){if(1&e&&(r.TgZ(0,"div",6),r.TgZ(1,"div",7),r.YNc(2,Me,2,1,"div",8),r.YNc(3,Oe,2,1,"div",9),r.qZA(),r.YNc(4,_e,2,1,"ng-container",10),r.qZA()),2&e){const e=r.oxw();r.xp6(2),r.Q6J("ngIf",e.nzTitle),r.xp6(1),r.Q6J("ngIf",e.nzExtra),r.xp6(1),r.Q6J("ngIf",e.listOfNzCardTabComponent)}}function Re(e,t){}function Pe(e,t){if(1&e&&(r.TgZ(0,"div",15),r.YNc(1,Re,0,0,"ng-template",14),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.Q6J("ngTemplateOutlet",e.nzCover)}}function Ye(e,t){1&e&&(r.ynx(0),r.Hsn(1),r.BQk())}function Ne(e,t){1&e&&r._UZ(0,"nz-card-loading")}function Be(e,t){}function De(e,t){if(1&e&&(r.TgZ(0,"li"),r.TgZ(1,"span"),r.YNc(2,Be,0,0,"ng-template",14),r.qZA(),r.qZA()),2&e){const e=t.$implicit,n=r.oxw(2);r.Udp("width",100/n.nzActions.length,"%"),r.xp6(2),r.Q6J("ngTemplateOutlet",e)}}function Je(e,t){if(1&e&&(r.TgZ(0,"ul",16),r.YNc(1,De,3,3,"li",17),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.Q6J("ngForOf",e.nzActions)}}function qe(e,t){1&e&&(r.TgZ(0,"div",4),r._UZ(1,"div",5),r.qZA()),2&e&&r.Q6J("ngClass",t.$implicit)}function Qe(e,t){if(1&e&&(r.TgZ(0,"div",2),r.YNc(1,qe,2,1,"div",3),r.qZA()),2&e){const e=t.$implicit;r.xp6(1),r.Q6J("ngForOf",e)}}let Fe=(()=>{class e{constructor(e){this.elementRef=e,this.nzHoverable=!0,this.elementRef.nativeElement.classList.add("ant-card-grid")}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.SBq))},e.\u0275dir=r.lG2({type:e,selectors:[["","nz-card-grid",""]],hostVars:2,hostBindings:function(e,t){2&e&&r.ekj("ant-card-hoverable",t.nzHoverable)},inputs:{nzHoverable:"nzHoverable"},exportAs:["nzCardGrid"]}),(0,u.gn)([(0,f.yF)()],e.prototype,"nzHoverable",void 0),e})(),Ie=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Xpm({type:e,selectors:[["nz-card-tab"]],viewQuery:function(e,t){if(1&e&&r.Gf(r.Rgc,7),2&e){let e;r.iGM(e=r.CRH())&&(t.template=e.first)}},exportAs:["nzCardTab"],ngContentSelectors:be,decls:1,vars:0,template:function(e,t){1&e&&(r.F$t(),r.YNc(0,Se,1,0,"ng-template"))},encapsulation:2,changeDetection:0}),e})();const Le="card";let Ee=(()=>{class e{constructor(e,t,n,i){this.nzConfigService=e,this.cdr=t,this.elementRef=n,this.directionality=i,this._nzModuleName=Le,this.nzBordered=!0,this.nzBorderless=!1,this.nzLoading=!1,this.nzHoverable=!1,this.nzBodyStyle=null,this.nzActions=[],this.nzType=null,this.nzSize="default",this.dir="ltr",this.destroy$=new g.xQ,this.elementRef.nativeElement.classList.add("ant-card"),this.nzConfigService.getConfigChangeEventForComponent(Le).pipe((0,p.R)(this.destroy$)).subscribe(()=>{this.cdr.markForCheck()})}ngOnInit(){var e;null===(e=this.directionality.change)||void 0===e||e.pipe((0,p.R)(this.destroy$)).subscribe(e=>{this.dir=e,this.cdr.detectChanges()}),this.dir=this.directionality.value}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(Te.jY),r.Y36(r.sBO),r.Y36(r.SBq),r.Y36(h.Is,8))},e.\u0275cmp=r.Xpm({type:e,selectors:[["nz-card"]],contentQueries:function(e,t,n){if(1&e&&(r.Suo(n,Ie,5),r.Suo(n,Fe,4)),2&e){let e;r.iGM(e=r.CRH())&&(t.listOfNzCardTabComponent=e.first),r.iGM(e=r.CRH())&&(t.listOfNzCardGridDirective=e)}},hostVars:16,hostBindings:function(e,t){2&e&&r.ekj("ant-card-loading",t.nzLoading)("ant-card-bordered",!1===t.nzBorderless&&t.nzBordered)("ant-card-hoverable",t.nzHoverable)("ant-card-small","small"===t.nzSize)("ant-card-contain-grid",t.listOfNzCardGridDirective&&t.listOfNzCardGridDirective.length)("ant-card-type-inner","inner"===t.nzType)("ant-card-contain-tabs",!!t.listOfNzCardTabComponent)("ant-card-rtl","rtl"===t.dir)},inputs:{nzBordered:"nzBordered",nzBorderless:"nzBorderless",nzLoading:"nzLoading",nzHoverable:"nzHoverable",nzBodyStyle:"nzBodyStyle",nzActions:"nzActions",nzType:"nzType",nzSize:"nzSize",nzCover:"nzCover",nzTitle:"nzTitle",nzExtra:"nzExtra"},exportAs:["nzCard"],ngContentSelectors:be,decls:7,vars:6,consts:[["class","ant-card-head",4,"ngIf"],["class","ant-card-cover",4,"ngIf"],[1,"ant-card-body",3,"ngStyle"],[4,"ngIf","ngIfElse"],["loadingTemplate",""],["class","ant-card-actions",4,"ngIf"],[1,"ant-card-head"],[1,"ant-card-head-wrapper"],["class","ant-card-head-title",4,"ngIf"],["class","ant-card-extra",4,"ngIf"],[4,"ngIf"],[1,"ant-card-head-title"],[4,"nzStringTemplateOutlet"],[1,"ant-card-extra"],[3,"ngTemplateOutlet"],[1,"ant-card-cover"],[1,"ant-card-actions"],[3,"width",4,"ngFor","ngForOf"]],template:function(e,t){if(1&e&&(r.F$t(),r.YNc(0,Ae,5,3,"div",0),r.YNc(1,Pe,2,1,"div",1),r.TgZ(2,"div",2),r.YNc(3,Ye,2,0,"ng-container",3),r.YNc(4,Ne,1,0,"ng-template",null,4,r.W1O),r.qZA(),r.YNc(6,Je,2,1,"ul",5)),2&e){const e=r.MAs(5);r.Q6J("ngIf",t.nzTitle||t.nzExtra||t.listOfNzCardTabComponent),r.xp6(1),r.Q6J("ngIf",t.nzCover),r.xp6(1),r.Q6J("ngStyle",t.nzBodyStyle),r.xp6(1),r.Q6J("ngIf",!t.nzLoading)("ngIfElse",e),r.xp6(3),r.Q6J("ngIf",t.nzActions.length)}},directives:function(){return[i.O5,i.PC,we.f,i.tP,$e,i.sg]},encapsulation:2,changeDetection:0}),(0,u.gn)([(0,Te.oS)(),(0,f.yF)()],e.prototype,"nzBordered",void 0),(0,u.gn)([(0,Te.oS)(),(0,f.yF)()],e.prototype,"nzBorderless",void 0),(0,u.gn)([(0,f.yF)()],e.prototype,"nzLoading",void 0),(0,u.gn)([(0,Te.oS)(),(0,f.yF)()],e.prototype,"nzHoverable",void 0),(0,u.gn)([(0,Te.oS)()],e.prototype,"nzSize",void 0),e})(),$e=(()=>{class e{constructor(e){this.elementRef=e,this.listOfLoading=[["ant-col-22"],["ant-col-8","ant-col-15"],["ant-col-6","ant-col-18"],["ant-col-13","ant-col-9"],["ant-col-4","ant-col-3","ant-col-16"],["ant-col-8","ant-col-6","ant-col-8"]],this.elementRef.nativeElement.classList.add("ant-card-loading-content")}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.SBq))},e.\u0275cmp=r.Xpm({type:e,selectors:[["nz-card-loading"]],exportAs:["nzCardLoading"],decls:2,vars:1,consts:[[1,"ant-card-loading-content"],["class","ant-row","style","margin-left: -4px; margin-right: -4px;",4,"ngFor","ngForOf"],[1,"ant-row",2,"margin-left","-4px","margin-right","-4px"],["style","padding-left: 4px; padding-right: 4px;",3,"ngClass",4,"ngFor","ngForOf"],[2,"padding-left","4px","padding-right","4px",3,"ngClass"],[1,"ant-card-loading-block"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0),r.YNc(1,Qe,2,1,"div",1),r.qZA()),2&e&&(r.xp6(1),r.Q6J("ngForOf",t.listOfLoading))},directives:[i.sg,i.mk],encapsulation:2,changeDetection:0}),e})(),Ue=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[i.ez,we.T],h.vT]}),e})();var He=n(6461),Ve=n(625),We=n(7636),je=n(6682),Xe=n(2759),Ge=n(9193),Ke=n(739),et=n(6736),tt=n(8002),nt=n(3190),it=n(5435),ot=n(13),rt=n(6956),st=n(6911),at=n(641),ct=n(7070);function lt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",0),r.NdJ("@slideMotion.done",function(t){return r.CHM(e),r.oxw().onAnimationEvent(t)})("mouseenter",function(){return r.CHM(e),r.oxw().setMouseState(!0)})("mouseleave",function(){return r.CHM(e),r.oxw().setMouseState(!1)}),r.Hsn(1),r.qZA()}if(2&e){const e=r.oxw();r.ekj("ant-dropdown-rtl","rtl"===e.dir),r.Q6J("ngClass",e.nzOverlayClassName)("ngStyle",e.nzOverlayStyle)("@slideMotion",void 0)("@.disabled",null==e.noAnimation?null:e.noAnimation.nzNoAnimation)("nzNoAnimation",null==e.noAnimation?null:e.noAnimation.nzNoAnimation)}}const dt=["*"],ht=[st.yW.bottomLeft,st.yW.bottomRight,st.yW.topRight,st.yW.topLeft];let gt=(()=>{class e{constructor(e,t,n,i,o){this.elementRef=e,this.overlay=t,this.renderer=n,this.viewContainerRef=i,this.platform=o,this.overlayRef=null,this.destroy$=new g.xQ,this.positionStrategy=this.overlay.position().flexibleConnectedTo(this.elementRef.nativeElement).withLockedPosition().withTransformOriginOn(".ant-dropdown"),this.inputVisible$=new a.X(!1),this.nzTrigger$=new a.X("hover"),this.overlayClose$=new g.xQ,this.nzDropdownMenu=null,this.nzTrigger="hover",this.nzMatchWidthElement=null,this.nzHasBackdrop=!1,this.nzBackdrop=!1,this.nzClickHide=!0,this.nzDisabled=!1,this.nzVisible=!1,this.nzOverlayClassName="",this.nzOverlayStyle={},this.nzPlacement="bottomLeft",this.nzVisibleChange=new r.vpe,this.elementRef.nativeElement.classList.add("ant-dropdown-trigger")}setDropdownMenuValue(e,t){this.nzDropdownMenu&&this.nzDropdownMenu.setValue(e,t)}ngAfterViewInit(){if(this.nzDropdownMenu){const e=this.elementRef.nativeElement,t=(0,je.T)((0,Xe.R)(e,"mouseenter").pipe((0,et.h)(!0)),(0,Xe.R)(e,"mouseleave").pipe((0,et.h)(!1))),n=(0,je.T)(this.nzDropdownMenu.mouseState$,t),i=(0,Xe.R)(e,"click").pipe((0,tt.U)(()=>!this.nzVisible)),o=this.nzTrigger$.pipe((0,nt.w)(e=>"hover"===e?n:"click"===e?i:Ge.E)),r=this.nzDropdownMenu.descendantMenuItemClick$.pipe((0,it.h)(()=>this.nzClickHide),(0,et.h)(!1)),s=(0,je.T)(o,r,this.overlayClose$).pipe((0,it.h)(()=>!this.nzDisabled)),a=(0,je.T)(this.inputVisible$,s);(0,Ke.aj)([a,this.nzDropdownMenu.isChildSubMenuOpen$]).pipe((0,tt.U)(([e,t])=>e||t),(0,ot.e)(150),(0,D.x)(),(0,it.h)(()=>this.platform.isBrowser),(0,p.R)(this.destroy$)).subscribe(t=>{const n=(this.nzMatchWidthElement?this.nzMatchWidthElement.nativeElement:e).getBoundingClientRect().width;this.nzVisible!==t&&this.nzVisibleChange.emit(t),this.nzVisible=t,t?(this.overlayRef?this.overlayRef.getConfig().minWidth=n:(this.overlayRef=this.overlay.create({positionStrategy:this.positionStrategy,minWidth:n,disposeOnNavigation:!0,hasBackdrop:(this.nzHasBackdrop||this.nzBackdrop)&&"click"===this.nzTrigger,scrollStrategy:this.overlay.scrollStrategies.reposition()}),(0,je.T)(this.overlayRef.backdropClick(),this.overlayRef.detachments(),this.overlayRef.outsidePointerEvents().pipe((0,it.h)(e=>!this.elementRef.nativeElement.contains(e.target))),this.overlayRef.keydownEvents().pipe((0,it.h)(e=>e.keyCode===He.hY&&!(0,He.Vb)(e)))).pipe((0,p.R)(this.destroy$)).subscribe(()=>{this.overlayClose$.next(!1)})),this.positionStrategy.withPositions([st.yW[this.nzPlacement],...ht]),this.portal&&this.portal.templateRef===this.nzDropdownMenu.templateRef||(this.portal=new We.UE(this.nzDropdownMenu.templateRef,this.viewContainerRef)),this.overlayRef.attach(this.portal)):this.overlayRef&&this.overlayRef.detach()}),this.nzDropdownMenu.animationStateChange$.pipe((0,p.R)(this.destroy$)).subscribe(e=>{"void"===e.toState&&(this.overlayRef&&this.overlayRef.dispose(),this.overlayRef=null)})}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=null)}ngOnChanges(e){const{nzVisible:t,nzDisabled:n,nzOverlayClassName:i,nzOverlayStyle:o,nzTrigger:r,nzHasBackdrop:s}=e;if(r&&this.nzTrigger$.next(this.nzTrigger),t&&this.inputVisible$.next(this.nzVisible),n){const e=this.elementRef.nativeElement;this.nzDisabled?(this.renderer.setAttribute(e,"disabled",""),this.inputVisible$.next(!1)):this.renderer.removeAttribute(e,"disabled")}i&&this.setDropdownMenuValue("nzOverlayClassName",this.nzOverlayClassName),o&&this.setDropdownMenuValue("nzOverlayStyle",this.nzOverlayStyle),s&&(0,rt.iX)("`nzHasBackdrop` in dropdown component will be removed in 13.0.0, please use `nzBackdrop` instead.")}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.SBq),r.Y36(Ve.aV),r.Y36(r.Qsj),r.Y36(r.s_b),r.Y36(m.t4))},e.\u0275dir=r.lG2({type:e,selectors:[["","nz-dropdown",""]],inputs:{nzDropdownMenu:"nzDropdownMenu",nzTrigger:"nzTrigger",nzMatchWidthElement:"nzMatchWidthElement",nzHasBackdrop:"nzHasBackdrop",nzBackdrop:"nzBackdrop",nzClickHide:"nzClickHide",nzDisabled:"nzDisabled",nzVisible:"nzVisible",nzOverlayClassName:"nzOverlayClassName",nzOverlayStyle:"nzOverlayStyle",nzPlacement:"nzPlacement"},outputs:{nzVisibleChange:"nzVisibleChange"},exportAs:["nzDropdown"],features:[r.TTD]}),(0,u.gn)([(0,f.yF)()],e.prototype,"nzHasBackdrop",void 0),(0,u.gn)([(0,f.yF)()],e.prototype,"nzBackdrop",void 0),(0,u.gn)([(0,f.yF)()],e.prototype,"nzClickHide",void 0),(0,u.gn)([(0,f.yF)()],e.prototype,"nzDisabled",void 0),(0,u.gn)([(0,f.yF)()],e.prototype,"nzVisible",void 0),e})(),pt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({}),e})(),ut=(()=>{class e{constructor(e,t,n,i,o,s,c){this.cdr=e,this.elementRef=t,this.renderer=n,this.viewContainerRef=i,this.nzMenuService=o,this.directionality=s,this.noAnimation=c,this.mouseState$=new a.X(!1),this.isChildSubMenuOpen$=this.nzMenuService.isChildSubMenuOpen$,this.descendantMenuItemClick$=this.nzMenuService.descendantMenuItemClick$,this.animationStateChange$=new r.vpe,this.nzOverlayClassName="",this.nzOverlayStyle={},this.dir="ltr",this.destroy$=new g.xQ}onAnimationEvent(e){this.animationStateChange$.emit(e)}setMouseState(e){this.mouseState$.next(e)}setValue(e,t){this[e]=t,this.cdr.markForCheck()}ngOnInit(){var e;null===(e=this.directionality.change)||void 0===e||e.pipe((0,p.R)(this.destroy$)).subscribe(e=>{this.dir=e,this.cdr.detectChanges()}),this.dir=this.directionality.value}ngAfterContentInit(){this.renderer.removeChild(this.renderer.parentNode(this.elementRef.nativeElement),this.elementRef.nativeElement)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.sBO),r.Y36(r.SBq),r.Y36(r.Qsj),r.Y36(r.s_b),r.Y36(v.hl),r.Y36(h.Is,8),r.Y36(at.P,9))},e.\u0275cmp=r.Xpm({type:e,selectors:[["nz-dropdown-menu"]],viewQuery:function(e,t){if(1&e&&r.Gf(r.Rgc,7),2&e){let e;r.iGM(e=r.CRH())&&(t.templateRef=e.first)}},exportAs:["nzDropdownMenu"],features:[r._Bn([v.hl,{provide:v.Cc,useValue:!0}])],ngContentSelectors:dt,decls:1,vars:0,consts:[[1,"ant-dropdown",3,"ngClass","ngStyle","nzNoAnimation","mouseenter","mouseleave"]],template:function(e,t){1&e&&(r.F$t(),r.YNc(0,lt,2,7,"ng-template"))},directives:[i.mk,i.PC,at.P],encapsulation:2,data:{animation:[ct.mF]},changeDetection:0}),e})(),mt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[h.vT,i.ez,Ve.U8,W.u5,te.sL,v.ip,C.PV,at.g,m.ud,st.e4,pt,we.T],v.ip]}),e})();function zt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"i",8),r.NdJ("click",function(){r.CHM(e);const t=r.oxw();return t.callService.toggleMicrophone(),t.isMuted=!t.isMuted}),r.qZA()}if(2&e){const e=r.oxw();r.ekj("text-primary",!e.isMuted),r.Q6J("nzType",e.isMuted?"audio-muted":"audio")("nzTheme",e.isMuted?"outline":"fill")}}function ft(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"i",9),r.NdJ("click",function(){r.CHM(e);const t=r.oxw();return t.callService.toggleCamera(),t.onCameraToggled.emit()}),r.qZA()}}function vt(e,t){1&e&&r._UZ(0,"i",10)}function yt(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"i",11),r.NdJ("click",function(){return r.CHM(e),r.oxw().callService.hangUp()}),r.qZA()}}function Ct(e,t){if(1&e){const e=r.EpF();r._UZ(0,"i",12),r.TgZ(1,"nz-dropdown-menu",null,13),r.TgZ(3,"ul",14),r.TgZ(4,"li",15),r.NdJ("click",function(){return r.CHM(e),r.oxw().toggleScreenSharing()}),r._uU(5),r.qZA(),r.TgZ(6,"li",16),r._uU(7,"2nd menu item length"),r.qZA(),r.TgZ(8,"li",16),r._uU(9,"3rd menu item length"),r.qZA(),r.qZA(),r.qZA()}if(2&e){const e=r.MAs(2),t=r.oxw();r.Q6J("nzDropdownMenu",e),r.xp6(5),r.Oqu(t.isScreenSharing?"Couper le partage":"Partager mon \xe9cran")}}new Ve.tR({originX:"start",originY:"top"},{overlayX:"start",overlayY:"top"}),new Ve.tR({originX:"start",originY:"top"},{overlayX:"start",overlayY:"bottom"}),new Ve.tR({originX:"start",originY:"top"},{overlayX:"end",overlayY:"bottom"}),new Ve.tR({originX:"start",originY:"top"},{overlayX:"end",overlayY:"top"});const Tt=function(e,t,n,i,o){return[e,t,n,i,o]};let wt=(()=>{class e{constructor(e){this.callService=e,this.isMuted=!1,this.isCamera=!1,this.isScreenSharing=!1,this.onCameraToggled=new r.vpe}ngOnDestroy(){this.callService.hangUp()}ngOnInit(){}toggleScreenSharing(){this.isScreenSharing?(this.callService.stopScreenShare(),this.isScreenSharing=!1):(this.callService.startScreenShare(),this.isScreenSharing=!0)}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(d))},e.\u0275cmp=r.Xpm({type:e,selectors:[["app-call-controls"]],outputs:{onCameraToggled:"onCameraToggled"},decls:14,vars:7,consts:[[1,"call-controls"],["nz-typography","",1,"text-center"],[2,"width","300px","margin-top","16px",3,"nzActions"],["actionMicrophone",""],["actionCamera",""],["actionChat",""],["actionHangUp",""],["actionEllipsis",""],["nz-icon","",3,"nzType","nzTheme","click"],["nz-icon","","nzType","video-camera","nzTheme","fill",3,"click"],["nz-icon","","nzType","message","nzTheme","fill"],["nz-icon","","nzType","api","nzTheme","fill",3,"click"],["nz-icon","","nzType","ellipsis","nz-dropdown","","nzPlacement","topLeft",3,"nzDropdownMenu"],["menu","nzDropdownMenu"],["nz-menu",""],["nz-menu-item","",3,"click"],["nz-menu-item",""]],template:function(e,t){if(1&e&&(r.TgZ(0,"div",0),r.TgZ(1,"h5",1),r._uU(2,"10 : 43"),r.qZA(),r._UZ(3,"nz-card",2),r.YNc(4,zt,1,4,"ng-template",null,3,r.W1O),r.YNc(6,ft,1,0,"ng-template",null,4,r.W1O),r.YNc(8,vt,1,0,"ng-template",null,5,r.W1O),r.YNc(10,yt,1,0,"ng-template",null,6,r.W1O),r.YNc(12,Ct,10,2,"ng-template",null,7,r.W1O),r.qZA()),2&e){const e=r.MAs(5),t=r.MAs(7),n=r.MAs(9),i=r.MAs(11),o=r.MAs(13);r.xp6(3),r.Q6J("nzActions",r.qbA(1,Tt,e,t,n,o,i))}},directives:[Ee,C.Ls,I.w,gt,ut,v.wO,v.r9],styles:["[_nghost-%COMP%]  .ant-card-body{display:none}.call-controls[_ngcontent-%COMP%]{position:fixed;bottom:50px;left:50%;transform:translateX(calc(-50% + 125px))}"]}),e})();const St=["myVideo"],bt=["videoFallback"],xt=[{path:"",component:ge,children:[{path:"room/:id",component:Ce},{path:"video-call",component:(()=>{class e{constructor(e,t,n){this.socketService=e,this.callService=t,this.route=n,this.hideVideo=!1,this.isAudio=!0}ngOnInit(){var e=this;return(0,s.Z)(function*(){e.peerConnection=e.callService.peerConnection,e.peerConnection.ontrack=t=>{e.isAudio="audio"==t.track.kind,e.video.nativeElement.srcObject=t.streams[0]},e.stream=yield e.callService.getMediaStream(!0),e.videoFallback.nativeElement.srcObject=e.stream,e.videoFallback.nativeElement.muted=!0})()}toggleCamera(){this.hideVideo=!this.hideVideo}ngOnDestroy(){var e;null===(e=this.stream)||void 0===e||e.getTracks().forEach(e=>{e.stop()}),this.callService.hangUp()}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(c.sk),r.Y36(d),r.Y36(o.gz))},e.\u0275cmp=r.Xpm({type:e,selectors:[["app-video-call"]],viewQuery:function(e,t){if(1&e&&(r.Gf(St,5),r.Gf(bt,5)),2&e){let e;r.iGM(e=r.CRH())&&(t.video=e.first),r.iGM(e=r.CRH())&&(t.videoFallback=e.first)}},decls:8,vars:7,consts:[[2,"height","93vh"],["autoplay","","playsinline","",1,"w-100","h-100"],["myVideo",""],[1,"cover"],["nzText","VD",2,"background-color","#5e53fc",3,"nzSize"],["autoplay","","playsinline","",1,"video-fallback"],["videoFallback",""],[3,"onCameraToggled"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0),r._UZ(1,"video",1,2),r.TgZ(3,"div",3),r._UZ(4,"nz-avatar",4),r.qZA(),r.qZA(),r._UZ(5,"video",5,6),r.TgZ(7,"app-call-controls",7),r.NdJ("onCameraToggled",function(){return t.toggleCamera()}),r.qZA()),2&e&&(r.xp6(1),r.ekj("d-none",t.isAudio),r.xp6(2),r.ekj("d-none",!t.isAudio),r.xp6(1),r.Q6J("nzSize",150),r.xp6(1),r.ekj("invisible",t.hideVideo))},directives:[oe.Dz,wt],styles:[".call-controls[_ngcontent-%COMP%]{position:fixed;bottom:50px;left:50%;transform:translateX(calc(-50% + 100px))}.video-fallback[_ngcontent-%COMP%]{position:fixed;bottom:50px;right:50px;width:400px;height:220px;border-radius:25px}.cover[_ngcontent-%COMP%]{z-index:100;width:100%;height:100%;display:flex;align-items:center;justify-content:center}[_nghost-%COMP%]  .ant-avatar-string{font-size:50px}"]}),e})()}]}];let Mt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[o.Bz.forChild(xt)],o.Bz]}),e})();n(9761);let kt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[i.ez,we.T,Ve.U8,st.e4,mt,C.PV],h.vT]}),e})();var Ot=n(4466);n(3342);var Zt=n(2930);let _t=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[h.vT,i.ez,m.ud,Zt.cg]]}),e})();var At=n(3314),Rt=n(3385);let Pt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e,bootstrap:[ge]}),e.\u0275inj=r.cJS({imports:[[i.ez,W.u5,Mt,B,kt,Ot.m,te.sL,_t,c.HB,Ue,K.o7,re.Xo,mt,At.Cl,oe.Rt,Rt.S]]}),e})()}}]);